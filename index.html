<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Life FM</title>
  <meta name="theme-color" content="#00b388" />
  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
</head>
<body>
  <button id="playBtn">â–¶</button>
  <div id="statusText">Status</div>
  <div id="statusDot" class="status-dot"></div>
  <audio id="audioPlayer" preload="none" class="audio-element">
    <source src="https://audioworker.jpcurtis58.workers.dev/" type="audio/aac" />
    Your browser does not support the audio element.
  </audio>

  <script>
    const audioPlayer = document.getElementById('audioPlayer');
    const playBtn = document.getElementById('playBtn');
    const statusText = document.getElementById('statusText');
    const statusDot = document.getElementById('statusDot');

    let isPlaying = false;
    let isLoading = false;

    function initializePlayer() {
      audioPlayer.volume = 0.8;
      audioPlayer.crossOrigin = "anonymous";
      audioPlayer.addEventListener('playing', handlePlaying);
      audioPlayer.addEventListener('pause', handlePause);
      audioPlayer.addEventListener('error', handleError);
    }

    function togglePlay() {
      if (isLoading) return;
      if (isPlaying) {
        audioPlayer.pause();
      } else {
        isLoading = true;
        updateStatus('Connecting...', false);
        playBtn.innerHTML = 'â¸';
        audioPlayer.play().catch(handleError);
      }
    }

    function handlePlaying() {
      isPlaying = true;
      isLoading = false;
      playBtn.innerHTML = 'â¸';
      updateStatus('ðŸ”´ LIVE', true);
    }

    function handlePause() {
      isPlaying = false;
      playBtn.innerHTML = 'â–¶';
      updateStatus('Paused', false);
    }

    function handleError(e) {
      console.error('Audio error:', e);
      isPlaying = false;
      isLoading = false;
      playBtn.innerHTML = 'â–¶';
      updateStatus('Connection Error - Tap to retry', false);
    }

    function updateStatus(text, live) {
      statusText.textContent = text;
      statusDot.className = live ? 'status-dot live' : 'status-dot';
    }

    document.addEventListener('DOMContentLoaded', function () {
      initializePlayer();
      playBtn.addEventListener('click', togglePlay);

      // First user interaction triggers preload
      const enablePreload = () => {
        audioPlayer.load();
        updateStatus('Ready', false);
        document.removeEventListener('click', enablePreload);
      };

      document.addEventListener('click', enablePreload);
    });
  </script>
</body>
</html>
